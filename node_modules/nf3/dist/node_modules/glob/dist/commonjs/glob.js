"use strict";Object.defineProperty(exports,`__esModule`,{value:!0}),exports.Glob=void 0;const minimatch_1=require(`minimatch`),node_url_1=require(`node:url`),path_scurry_1=require(`path-scurry`),pattern_js_1=require(`./pattern.js`),walker_js_1=require(`./walker.js`),defaultPlatform=typeof process==`object`&&process&&typeof process.platform==`string`?process.platform:`linux`;class Glob{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(r,i){if(!i)throw TypeError(`glob options required`);if(this.withFileTypes=!!i.withFileTypes,this.signal=i.signal,this.follow=!!i.follow,this.dot=!!i.dot,this.dotRelative=!!i.dotRelative,this.nodir=!!i.nodir,this.mark=!!i.mark,i.cwd?(i.cwd instanceof URL||i.cwd.startsWith(`file://`))&&(i.cwd=(0,node_url_1.fileURLToPath)(i.cwd)):this.cwd=``,this.cwd=i.cwd||``,this.root=i.root,this.magicalBraces=!!i.magicalBraces,this.nobrace=!!i.nobrace,this.noext=!!i.noext,this.realpath=!!i.realpath,this.absolute=i.absolute,this.includeChildMatches=i.includeChildMatches!==!1,this.noglobstar=!!i.noglobstar,this.matchBase=!!i.matchBase,this.maxDepth=typeof i.maxDepth==`number`?i.maxDepth:1/0,this.stat=!!i.stat,this.ignore=i.ignore,this.withFileTypes&&this.absolute!==void 0)throw Error(`cannot set absolute and withFileTypes:true`);if(typeof r==`string`&&(r=[r]),this.windowsPathsNoEscape=!!i.windowsPathsNoEscape||i.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(r=r.map(e=>e.replace(/\\/g,`/`))),this.matchBase){if(i.noglobstar)throw TypeError(`base matching requires globstar`);r=r.map(e=>e.includes(`/`)?e:`./**/${e}`)}if(this.pattern=r,this.platform=i.platform||defaultPlatform,this.opts={...i,platform:this.platform},i.scurry){if(this.scurry=i.scurry,i.nocase!==void 0&&i.nocase!==i.scurry.nocase)throw Error(`nocase option contradicts provided scurry option`)}else this.scurry=new(i.platform===`win32`?path_scurry_1.PathScurryWin32:i.platform===`darwin`?path_scurry_1.PathScurryDarwin:i.platform?path_scurry_1.PathScurryPosix:path_scurry_1.PathScurry)(this.cwd,{nocase:i.nocase,fs:i.fs});this.nocase=this.scurry.nocase;let a=this.platform===`darwin`||this.platform===`win32`,o={...i,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:a,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},[s,c]=this.pattern.map(t=>new minimatch_1.Minimatch(t,o)).reduce((e,t)=>(e[0].push(...t.set),e[1].push(...t.globParts),e),[[],[]]);this.patterns=s.map((e,t)=>{let n=c[t];if(!n)throw Error(`invalid pattern object`);return new pattern_js_1.Pattern(e,n,0,this.platform)})}async walk(){return[...await new walker_js_1.GlobWalker(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new walker_js_1.GlobWalker(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new walker_js_1.GlobStream(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new walker_js_1.GlobStream(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth===1/0?1/0:this.maxDepth+this.scurry.cwd.depth(),platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}}exports.Glob=Glob;