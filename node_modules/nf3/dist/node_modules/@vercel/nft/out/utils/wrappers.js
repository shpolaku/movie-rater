"use strict";Object.defineProperty(exports,`__esModule`,{value:!0}),exports.handleWrappers=handleWrappers;const estree_walker_1=require(`estree-walker`);function isUndefinedOrVoid(e){return e.type===`Identifier`&&e.name===`undefined`||e.type===`UnaryExpression`&&e.operator===`void`&&e.argument.type===`Literal`&&e.argument.value===0}function handleWrappers(n){let r;if(n.body.length===1&&n.body[0].type===`ExpressionStatement`&&n.body[0].expression.type===`UnaryExpression`&&n.body[0].expression.operator===`!`&&n.body[0].expression.argument.type===`CallExpression`&&n.body[0].expression.argument.callee.type===`FunctionExpression`&&n.body[0].expression.argument.arguments.length===1?r=n.body[0].expression.argument:n.body.length===1&&n.body[0].type===`ExpressionStatement`&&n.body[0].expression.type===`CallExpression`&&n.body[0].expression.callee.type===`FunctionExpression`&&(n.body[0].expression.arguments.length===1||n.body[0].expression.arguments.length===0)?r=n.body[0].expression:n.body.length===1&&n.body[0].type===`ExpressionStatement`&&n.body[0].expression.type===`AssignmentExpression`&&n.body[0].expression.left.type===`MemberExpression`&&n.body[0].expression.left.object.type===`Identifier`&&n.body[0].expression.left.object.name===`module`&&n.body[0].expression.left.property.type===`Identifier`&&n.body[0].expression.left.property.name===`exports`&&n.body[0].expression.right.type===`CallExpression`&&n.body[0].expression.right.callee.type===`FunctionExpression`&&n.body[0].expression.right.arguments.length===1&&(r=n.body[0].expression.right),r){let n,i;if(r.arguments[0]&&r.arguments[0].type===`ConditionalExpression`&&r.arguments[0].test.type===`LogicalExpression`&&r.arguments[0].test.operator===`&&`&&r.arguments[0].test.left.type===`BinaryExpression`&&r.arguments[0].test.left.operator===`===`&&r.arguments[0].test.left.left.type===`UnaryExpression`&&r.arguments[0].test.left.left.operator===`typeof`&&`name`in r.arguments[0].test.left.left.argument&&r.arguments[0].test.left.left.argument.name===`define`&&r.arguments[0].test.left.right.type===`Literal`&&r.arguments[0].test.left.right.value===`function`&&r.arguments[0].test.right.type===`MemberExpression`&&r.arguments[0].test.right.object.type===`Identifier`&&r.arguments[0].test.right.property.type===`Identifier`&&r.arguments[0].test.right.property.name===`amd`&&r.arguments[0].test.right.computed===!1&&r.arguments[0].alternate.type===`FunctionExpression`&&r.arguments[0].alternate.params.length===1&&r.arguments[0].alternate.params[0].type===`Identifier`&&r.arguments[0].alternate.body.body.length===1&&r.arguments[0].alternate.body.body[0].type===`ExpressionStatement`&&r.arguments[0].alternate.body.body[0].expression.type===`AssignmentExpression`&&r.arguments[0].alternate.body.body[0].expression.left.type===`MemberExpression`&&r.arguments[0].alternate.body.body[0].expression.left.object.type===`Identifier`&&r.arguments[0].alternate.body.body[0].expression.left.object.name===`module`&&r.arguments[0].alternate.body.body[0].expression.left.property.type===`Identifier`&&r.arguments[0].alternate.body.body[0].expression.left.property.name===`exports`&&r.arguments[0].alternate.body.body[0].expression.left.computed===!1&&r.arguments[0].alternate.body.body[0].expression.right.type===`CallExpression`&&r.arguments[0].alternate.body.body[0].expression.right.callee.type===`Identifier`&&r.arguments[0].alternate.body.body[0].expression.right.callee.name===r.arguments[0].alternate.params[0].name&&`body`in r.callee&&`body`in r.callee.body&&Array.isArray(r.callee.body.body)&&r.arguments[0].alternate.body.body[0].expression.right.arguments.length===1&&r.arguments[0].alternate.body.body[0].expression.right.arguments[0].type===`Identifier`&&r.arguments[0].alternate.body.body[0].expression.right.arguments[0].name===`require`){let e=r.callee.body.body;if(e[0].type===`ExpressionStatement`&&e[0].expression.type===`Literal`&&e[0].expression.value===`use strict`&&(e=e.slice(1)),e.length===1&&e[0].type===`ExpressionStatement`&&e[0].expression.type===`CallExpression`&&e[0].expression.callee.type===`Identifier`&&e[0].expression.callee.name===r.arguments[0].test.right.object.name&&e[0].expression.arguments.length===1&&e[0].expression.arguments[0].type===`FunctionExpression`&&e[0].expression.arguments[0].params.length===1&&e[0].expression.arguments[0].params[0].type===`Identifier`&&e[0].expression.arguments[0].params[0].name===`require`){let t=e[0].expression.arguments[0];t.params=[];try{delete t.scope.declarations.require}catch{}}}else if(r.arguments[0]&&r.arguments[0].type===`FunctionExpression`&&r.arguments[0].params.length===0&&(r.arguments[0].body.body.length===1||r.arguments[0].body.body.length===2&&r.arguments[0].body.body[0].type===`VariableDeclaration`&&r.arguments[0].body.body[0].declarations.length===3&&r.arguments[0].body.body[0].declarations.every(e=>e.init===null&&e.id.type===`Identifier`))&&r.arguments[0].body.body[r.arguments[0].body.body.length-1].type===`ReturnStatement`&&(n=r.arguments[0].body.body[r.arguments[0].body.body.length-1])&&n.argument?.type===`CallExpression`&&n.argument.arguments.length&&n.argument.arguments.every(e=>e&&e.type===`Literal`&&typeof e.value==`number`)&&n.argument.callee.type===`CallExpression`&&(n.argument.callee.callee.type===`FunctionExpression`||n.argument.callee.callee.type===`CallExpression`&&n.argument.callee.callee.callee.type===`FunctionExpression`&&n.argument.callee.callee.arguments.length===0)&&n.argument.callee.arguments.length===3&&n.argument.callee.arguments[0].type===`ObjectExpression`&&n.argument.callee.arguments[1].type===`ObjectExpression`&&n.argument.callee.arguments[2].type===`ArrayExpression`){let e=n.argument.callee.arguments[0].properties,r={};if(e.every(e=>{if(e.type!==`Property`||e.computed!==!1||e.key.type!==`Literal`||typeof e.key.value!=`number`||e.value.type!==`ArrayExpression`||e.value.elements.length!==2||!e.value.elements[0]||!e.value.elements[1]||e.value.elements[0].type!==`FunctionExpression`||e.value.elements[1].type!==`ObjectExpression`)return!1;let n=e.value.elements[1].properties;for(let e of n){if(e.type!==`Property`||e.value.type!==`Identifier`&&e.value.type!==`Literal`&&!isUndefinedOrVoid(e.value)||!(e.key.type===`Literal`&&typeof e.key.value==`string`||e.key.type===`Identifier`)||e.computed)return!1;isUndefinedOrVoid(e.value)&&(e.key.type===`Identifier`?r[e.key.name]={type:`Literal`,start:e.key.start,end:e.key.end,value:e.key.name,raw:JSON.stringify(e.key.name)}:e.key.type===`Literal`&&(r[String(e.key.value)]=e.key))}return!0})){let e=Object.keys(r),t=n.argument.callee.arguments[1];t.properties=e.map(e=>({type:`Property`,method:!1,shorthand:!1,computed:!1,kind:`init`,key:r[e],value:{type:`ObjectExpression`,properties:[{type:`Property`,kind:`init`,method:!1,shorthand:!1,computed:!1,key:{type:`Identifier`,name:`exports`},value:{type:`CallExpression`,optional:!1,callee:{type:`Identifier`,name:`require`},arguments:[r[e]]}}]}}))}}else if(r.arguments[0]&&r.arguments[0].type===`FunctionExpression`&&r.arguments[0].params.length===2&&r.arguments[0].params[0].type===`Identifier`&&r.arguments[0].params[1].type===`Identifier`&&`body`in r.callee&&`body`in r.callee.body&&Array.isArray(r.callee.body.body)&&r.callee.body.body.length===1){let e=r.callee.body.body[0];if(e.type===`IfStatement`&&e.test.type===`LogicalExpression`&&e.test.operator===`&&`&&e.test.left.type===`BinaryExpression`&&e.test.left.left.type===`UnaryExpression`&&e.test.left.left.operator===`typeof`&&e.test.left.left.argument.type===`Identifier`&&e.test.left.left.argument.name===`module`&&e.test.left.right.type===`Literal`&&e.test.left.right.value===`object`&&e.test.right.type===`BinaryExpression`&&e.test.right.left.type===`UnaryExpression`&&e.test.right.left.operator===`typeof`&&e.test.right.left.argument.type===`MemberExpression`&&e.test.right.left.argument.object.type===`Identifier`&&e.test.right.left.argument.object.name===`module`&&e.test.right.left.argument.property.type===`Identifier`&&e.test.right.left.argument.property.name===`exports`&&e.test.right.right.type===`Literal`&&e.test.right.right.value===`object`&&e.consequent.type===`BlockStatement`&&e.consequent.body.length>0){let t;if(e.consequent.body[0].type===`VariableDeclaration`&&e.consequent.body[0].declarations[0].init&&e.consequent.body[0].declarations[0].init.type===`CallExpression`?t=e.consequent.body[0].declarations[0].init:e.consequent.body[0].type===`ExpressionStatement`&&e.consequent.body[0].expression.type===`CallExpression`?t=e.consequent.body[0].expression:e.consequent.body[0].type===`ExpressionStatement`&&e.consequent.body[0].expression.type===`AssignmentExpression`&&e.consequent.body[0].expression.operator===`=`&&e.consequent.body[0].expression.right.type===`CallExpression`&&(t=e.consequent.body[0].expression.right),t&&t.callee.type===`Identifier`&&`params`in r.callee&&r.callee.params.length>0&&`name`in r.callee.params[0]&&t.callee.name===r.callee.params[0].name&&t.arguments.length===2&&t.arguments[0].type===`Identifier`&&t.arguments[0].name===`require`&&t.arguments[1].type===`Identifier`&&t.arguments[1].name===`exports`){let e=r.arguments[0];e.params=[];try{let t=e.scope;delete t.declarations.require,delete t.declarations.exports}catch{}}}}else if(r.callee.type===`FunctionExpression`&&r.callee.body.body.length>2&&r.callee.body.body[0].type===`VariableDeclaration`&&r.callee.body.body[0].declarations.length===1&&r.callee.body.body[0].declarations[0].type===`VariableDeclarator`&&r.callee.body.body[0].declarations[0].id.type===`Identifier`&&r.callee.body.body[0].declarations[0].init&&(r.callee.body.body[0].declarations[0].init.type===`ObjectExpression`&&r.callee.body.body[0].declarations[0].init.properties.length===0||r.callee.body.body[0].declarations[0].init.type===`CallExpression`&&r.callee.body.body[0].declarations[0].init.arguments.length===1)&&(r.callee.body.body[1]&&r.callee.body.body[1].type===`FunctionDeclaration`&&r.callee.body.body[1].params.length===1&&r.callee.body.body[1].body.body.length>=3||r.callee.body.body[2]&&r.callee.body.body[2].type===`FunctionDeclaration`&&r.callee.body.body[2].params.length===1&&r.callee.body.body[2].body.body.length>=3)&&r.arguments[0]&&(r.arguments[0].type===`ArrayExpression`&&(i=r.arguments[0])&&r.arguments[0].elements.length>0&&r.arguments[0].elements.every(e=>e&&e.type===`FunctionExpression`)||r.arguments[0].type===`ObjectExpression`&&(i=r.arguments[0])&&r.arguments[0].properties&&r.arguments[0].properties.length>0&&r.arguments[0].properties.every(e=>e&&e.type===`Property`&&!e.computed&&e.key&&e.key.type===`Literal`&&(typeof e.key.value==`string`||typeof e.key.value==`number`)&&e.value&&e.value.type===`FunctionExpression`))||r.arguments.length===0&&r.callee.type===`FunctionExpression`&&r.callee.params.length===0&&r.callee.body.type===`BlockStatement`&&r.callee.body.body.length>5&&r.callee.body.body[0].type===`VariableDeclaration`&&r.callee.body.body[0].declarations.length===1&&r.callee.body.body[0].declarations[0].id.type===`Identifier`&&r.callee.body.body[1].type===`ExpressionStatement`&&r.callee.body.body[1].expression.type===`AssignmentExpression`&&r.callee.body.body[2].type===`ExpressionStatement`&&r.callee.body.body[2].expression.type===`AssignmentExpression`&&r.callee.body.body[3].type===`ExpressionStatement`&&r.callee.body.body[3].expression.type===`AssignmentExpression`&&r.callee.body.body[3].expression.left.type===`MemberExpression`&&r.callee.body.body[3].expression.left.object.type===`Identifier`&&r.callee.body.body[3].expression.left.object.name===r.callee.body.body[0].declarations[0].id.name&&r.callee.body.body[3].expression.left.property.type===`Identifier`&&r.callee.body.body[3].expression.left.property.name===`modules`&&r.callee.body.body[3].expression.right.type===`ObjectExpression`&&r.callee.body.body[3].expression.right.properties.every(e=>e&&e.type===`Property`&&!e.computed&&e.key&&e.key.type===`Literal`&&(typeof e.key.value==`string`||typeof e.key.value==`number`)&&e.value&&e.value.type===`FunctionExpression`)&&(i=r.callee.body.body[3].expression.right)&&(r.callee.body.body[4].type===`VariableDeclaration`&&r.callee.body.body[4].declarations.length===1&&r.callee.body.body[4].declarations[0].init&&r.callee.body.body[4].declarations[0].init.type===`CallExpression`&&r.callee.body.body[4].declarations[0].init.callee.type===`Identifier`&&r.callee.body.body[4].declarations[0].init.callee.name===`require`||r.callee.body.body[5].type===`VariableDeclaration`&&r.callee.body.body[5].declarations.length===1&&r.callee.body.body[5].declarations[0].init&&r.callee.body.body[5].declarations[0].init.type===`CallExpression`&&r.callee.body.body[5].declarations[0].init.callee.type===`Identifier`&&r.callee.body.body[5].declarations[0].init.callee.name===`require`)){let t=new Map,n;n=i.type===`ArrayExpression`?i.elements.filter(e=>e?.type===`FunctionExpression`).map((e,t)=>[String(t),e]):i.properties.map(e=>[String(e.key.value),e.value]);for(let[e,r]of n){let n=r.body.body.length===1?r.body.body[0]:(r.body.body.length===2||r.body.body.length===3&&r.body.body[2].type===`EmptyStatement`)&&r.body.body[0].type===`ExpressionStatement`&&r.body.body[0].expression.type===`Literal`&&r.body.body[0].expression.value===`use strict`?r.body.body[1]:null;n&&n.type===`ExpressionStatement`&&n.expression.type===`AssignmentExpression`&&n.expression.operator===`=`&&n.expression.left.type===`MemberExpression`&&n.expression.left.object.type===`Identifier`&&`params`in r&&r.params.length>0&&`name`in r.params[0]&&n.expression.left.object.name===r.params[0].name&&n.expression.left.property.type===`Identifier`&&n.expression.left.property.name===`exports`&&n.expression.right.type===`CallExpression`&&n.expression.right.callee.type===`Identifier`&&n.expression.right.callee.name===`require`&&n.expression.right.arguments.length===1&&n.expression.right.arguments[0].type===`Literal`&&t.set(e,n.expression.right.arguments[0].value)}for(let[,r]of n)if(`params`in r&&r.params.length===3&&r.params[2].type===`Identifier`){let n=new Map;(0,estree_walker_1.walk)(r.body,{enter(e,i){let a=e,o=i;if(a.type===`CallExpression`&&a.callee.type===`Identifier`&&`name`in r.params[2]&&a.callee.name===r.params[2].name&&a.arguments.length===1&&a.arguments[0].type===`Literal`){let e=t.get(String(a.arguments[0].value));if(e){let t={type:`CallExpression`,optional:!1,callee:{type:`Identifier`,name:`require`},arguments:[{type:`Literal`,value:e}]},r=o;`right`in r&&r.right===a?r.right=t:`left`in r&&r.left===a?r.left=t:`object`in r&&r.object===a?r.object=t:`callee`in r&&r.callee===a?r.callee=t:`arguments`in r&&r.arguments.some(e=>e===a)?r.arguments=r.arguments.map(e=>e===a?t:e):`init`in r&&r.init===a&&(r.type===`VariableDeclarator`&&r.id.type===`Identifier`&&n.set(r.id.name,e),r.init=t)}}else if(a.type===`CallExpression`&&a.callee.type===`MemberExpression`&&a.callee.object.type===`Identifier`&&`name`in r.params[2]&&a.callee.object.name===r.params[2].name&&a.callee.property.type===`Identifier`&&a.callee.property.name===`n`&&a.arguments.length===1&&a.arguments[0].type===`Identifier`&&o&&`init`in o&&o.init===a){let e=a.arguments[0];o.init={type:`CallExpression`,optional:!1,callee:{type:`MemberExpression`,computed:!1,optional:!1,object:{type:`Identifier`,name:`Object`},property:{type:`Identifier`,name:`assign`}},arguments:[{type:`ArrowFunctionExpression`,expression:!0,params:[],body:e},{type:`ObjectExpression`,properties:[{type:`Property`,kind:`init`,method:!1,computed:!1,shorthand:!1,key:{type:`Identifier`,name:`a`},value:e}]}]}}}})}}}}