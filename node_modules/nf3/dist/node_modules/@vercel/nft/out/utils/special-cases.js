"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,`__esModule`,{value:!0}),exports.default=handleSpecialCases;const path_1=require(`path`),resolve_dependency_1=__importDefault(require(`../resolve-dependency`)),get_package_base_1=require(`./get-package-base`),graceful_fs_1=require(`graceful-fs`),specialCases={"@generated/photon"({id:e,emitAssetDirectory:n}){e.endsWith(`@generated/photon/index.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e),`runtime/`))},"@serialport/bindings-cpp"({id:e,emitAssetDirectory:n}){e.endsWith(`@serialport/bindings-cpp/dist/index.js`)&&(n((0,path_1.resolve)((0,path_1.dirname)(e),`..`,`build`,`Release`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`..`,`prebuilds`)))},argon2({id:e,emitAssetDirectory:n}){e.endsWith(`argon2/argon2.js`)&&(n((0,path_1.resolve)((0,path_1.dirname)(e),`build`,`Release`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`prebuilds`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`lib`,`binding`)))},bull({id:e,emitAssetDirectory:n}){e.endsWith(`bull/lib/commands/index.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e)))},camaro({id:e,emitAsset:n}){e.endsWith(`camaro/dist/camaro.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e),`camaro.wasm`))},esbuild({id:e,emitAssetDirectory:n}){if(e.endsWith(`esbuild/lib/main.js`)){let r=(0,path_1.resolve)(e,`..`,`..`,`package.json`),a=JSON.parse((0,graceful_fs_1.readFileSync)(r,`utf8`));for(let r of Object.keys(a.optionalDependencies||{}))n((0,path_1.resolve)(e,`..`,`..`,`..`,r))}},"ffmpeg-static"({id:e,emitAsset:t}){e.endsWith(`ffmpeg-static/index.js`)&&t(require(e))},"google-gax"({id:e,ast:n,emitAssetDirectory:r}){if(e.endsWith(`google-gax/build/src/grpc.js`))for(let i of n.body)i.type===`VariableDeclaration`&&i.declarations[0].id.type===`Identifier`&&i.declarations[0].id.name===`googleProtoFilesDir`&&r((0,path_1.resolve)((0,path_1.dirname)(e),`../../../google-proto-files`))},oracledb({id:e,ast:n,emitAsset:r}){if(e.endsWith(`oracledb/lib/oracledb.js`)){for(let a of n.body)if(a.type===`ForStatement`&&`body`in a.body&&a.body.body&&Array.isArray(a.body.body)&&a.body.body[0]&&a.body.body[0].type===`TryStatement`&&a.body.body[0].block.body[0]&&a.body.body[0].block.body[0].type===`ExpressionStatement`&&a.body.body[0].block.body[0].expression.type===`AssignmentExpression`&&a.body.body[0].block.body[0].expression.operator===`=`&&a.body.body[0].block.body[0].expression.left.type===`Identifier`&&a.body.body[0].block.body[0].expression.left.name===`oracledbCLib`&&a.body.body[0].block.body[0].expression.right.type===`CallExpression`&&a.body.body[0].block.body[0].expression.right.callee.type===`Identifier`&&a.body.body[0].block.body[0].expression.right.callee.name===`require`&&a.body.body[0].block.body[0].expression.right.arguments.length===1&&a.body.body[0].block.body[0].expression.right.arguments[0].type===`MemberExpression`&&a.body.body[0].block.body[0].expression.right.arguments[0].computed===!0&&a.body.body[0].block.body[0].expression.right.arguments[0].object.type===`Identifier`&&a.body.body[0].block.body[0].expression.right.arguments[0].object.name===`binaryLocations`&&a.body.body[0].block.body[0].expression.right.arguments[0].property.type===`Identifier`&&a.body.body[0].block.body[0].expression.right.arguments[0].property.name===`i`){a.body.body[0].block.body[0].expression.right.arguments=[{type:`Literal`,value:`_`}];let n=global._unit?`3.0.0`:JSON.parse((0,graceful_fs_1.readFileSync)(e.slice(0,-15)+`package.json`,`utf8`)).version,o=`oracledb-`+(Number(n.slice(0,n.indexOf(`.`)))>=4?n:`abi`+process.versions.modules)+`-`+process.platform+`-`+process.arch+`.node`;r((0,path_1.resolve)(e,`../../build/Release/`+o))}}},"phantomjs-prebuilt"({id:e,emitAssetDirectory:n}){e.endsWith(`phantomjs-prebuilt/lib/phantomjs.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e),`..`,`bin`))},"remark-prism"({id:e,emitAssetDirectory:n}){if(e.endsWith(`remark-prism/src/highlight.js`))try{let r=e.slice(0,-29);n((0,path_1.resolve)(r,`prismjs`,`components`))}catch{}},semver({id:e,emitAsset:n}){e.endsWith(`semver/index.js`)&&n((0,path_1.resolve)(e.replace(`index.js`,`preload.js`)))},sharp:async({id:e,emitAssetDirectory:n,job:r})=>{if(e.endsWith(`sharp/lib/index.js`)){let a=(0,path_1.resolve)(e,`..`,`..`,`package.json`),o=JSON.parse((0,graceful_fs_1.readFileSync)(a,`utf8`));for(let a of Object.keys(o.optionalDependencies||{})){let o=(0,path_1.resolve)(e,`..`,`..`,`..`,a);n(o);try{let e=(0,path_1.resolve)(o,`package.json`),a=JSON.parse((0,graceful_fs_1.readFileSync)(e,`utf8`));for(let e of Object.keys(a.optionalDependencies||{}))n((0,path_1.resolve)(await r.realpath(o),`..`,`..`,e))}catch(e){if(e&&e.code!==`ENOENT`)throw console.error(`Error reading "sharp" dependencies from "${o}/package.json"'`),e}}}},shiki({id:e,emitAssetDirectory:n}){e.endsWith(`/dist/index.js`)&&(n((0,path_1.resolve)((0,path_1.dirname)(e),`..`,`languages`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`..`,`themes`)))},"socket.io":async function({id:e,ast:r,job:i}){if(e.endsWith(`socket.io/lib/index.js`)){async function a(r){if(r.type===`ExpressionStatement`&&r.expression.type===`AssignmentExpression`&&r.expression.operator===`=`&&r.expression.right.type===`CallExpression`&&r.expression.right.callee.type===`Identifier`&&r.expression.right.callee.name===`read`&&r.expression.right.arguments.length>=1&&r.expression.right.arguments[0].type===`CallExpression`&&r.expression.right.arguments[0].callee.type===`Identifier`&&r.expression.right.arguments[0].callee.name===`resolvePath`&&r.expression.right.arguments[0].arguments.length===1&&r.expression.right.arguments[0].arguments[0].type===`Literal`){let a=r.expression.right.arguments[0].arguments[0].value,o;try{let t=await(0,resolve_dependency_1.default)(String(a),e,i);if(typeof t==`string`)o=t;else return}catch{return}let s=`/`+(0,path_1.relative)((0,path_1.dirname)(e),o);r.expression.right.arguments[0]={type:`BinaryExpression`,start:r.expression.right.arguments[0].start,end:r.expression.right.arguments[0].end,operator:`+`,left:{type:`Identifier`,name:`__dirname`},right:{type:`Literal`,value:s,raw:JSON.stringify(s)}}}}for(let e of r.body)if(e.type===`ExpressionStatement`&&e.expression.type===`AssignmentExpression`&&e.expression.operator===`=`&&e.expression.left.type===`MemberExpression`&&e.expression.left.object.type===`MemberExpression`&&e.expression.left.object.object.type===`Identifier`&&e.expression.left.object.object.name===`Server`&&e.expression.left.object.property.type===`Identifier`&&e.expression.left.object.property.name===`prototype`&&e.expression.left.property.type===`Identifier`&&e.expression.left.property.name===`serveClient`&&e.expression.right.type===`FunctionExpression`){for(let t of e.expression.right.body.body)if(t.type===`IfStatement`&&t.consequent&&`body`in t.consequent&&t.consequent.body){let e=t.consequent.body,n=!1;Array.isArray(e)&&e[0]&&e[0].type===`ExpressionStatement`&&(n=await a(e[0])),Array.isArray(e)&&e[1]&&e[1].type===`TryStatement`&&e[1].block.body&&e[1].block.body[0]&&(n=await a(e[1].block.body[0])||n);return}}}},typescript({id:e,emitAssetDirectory:n}){e.endsWith(`typescript/lib/tsc.js`)&&n((0,path_1.resolve)(e,`../`))},"uglify-es"({id:e,emitAsset:n}){e.endsWith(`uglify-es/tools/node.js`)&&(n((0,path_1.resolve)(e,`../../lib/utils.js`)),n((0,path_1.resolve)(e,`../../lib/ast.js`)),n((0,path_1.resolve)(e,`../../lib/parse.js`)),n((0,path_1.resolve)(e,`../../lib/transform.js`)),n((0,path_1.resolve)(e,`../../lib/scope.js`)),n((0,path_1.resolve)(e,`../../lib/output.js`)),n((0,path_1.resolve)(e,`../../lib/compress.js`)),n((0,path_1.resolve)(e,`../../lib/sourcemap.js`)),n((0,path_1.resolve)(e,`../../lib/mozilla-ast.js`)),n((0,path_1.resolve)(e,`../../lib/propmangle.js`)),n((0,path_1.resolve)(e,`../../lib/minify.js`)),n((0,path_1.resolve)(e,`../exports.js`)))},"uglify-js"({id:e,emitAsset:n,emitAssetDirectory:r}){e.endsWith(`uglify-js/tools/node.js`)&&(r((0,path_1.resolve)(e,`../../lib`)),n((0,path_1.resolve)(e,`../exports.js`)))},"playwright-core"({id:e,emitAsset:n}){e.endsWith(`playwright-core/index.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e),`browsers.json`))},"geo-tz"({id:e,emitAsset:n}){e.endsWith(`geo-tz/dist/geo-tz.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e),`../data/geo.dat`))},pixelmatch({id:e,emitDependency:n}){e.endsWith(`pixelmatch/index.js`)&&n((0,path_1.resolve)((0,path_1.dirname)(e),`bin/pixelmatch`))},"geoip-lite"({id:e,emitAsset:n}){e.endsWith(`geoip-lite/lib/geoip.js`)&&(n((0,path_1.resolve)((0,path_1.dirname)(e),`../data/geoip-city.dat`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`../data/geoip-city6.dat`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`../data/geoip-city-names.dat`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`../data/geoip-country.dat`)),n((0,path_1.resolve)((0,path_1.dirname)(e),`../data/geoip-country6.dat`)))}};async function handleSpecialCases({id:e,ast:t,emitDependency:n,emitAsset:i,emitAssetDirectory:o,job:s}){let c=specialCases[(0,get_package_base_1.getPackageName)(e)||``];e=e.replace(/\\/g,`/`),c&&await c({id:e,ast:t,emitDependency:n,emitAsset:i,emitAssetDirectory:o,job:s})}