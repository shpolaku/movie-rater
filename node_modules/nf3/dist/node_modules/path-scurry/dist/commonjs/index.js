"use strict";var __createBinding=this&&this.__createBinding||(Object.create?(function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||(`get`in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}):(function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]})),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?(function(e,t){Object.defineProperty(e,`default`,{enumerable:!0,value:t})}):function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var r={};if(n!=null)for(var i in n)i!==`default`&&Object.prototype.hasOwnProperty.call(n,i)&&__createBinding(r,n,i);return __setModuleDefault(r,n),r};Object.defineProperty(exports,`__esModule`,{value:!0}),exports.PathScurry=exports.Path=exports.PathScurryDarwin=exports.PathScurryPosix=exports.PathScurryWin32=exports.PathScurryBase=exports.PathPosix=exports.PathWin32=exports.PathBase=exports.ChildrenCache=exports.ResolveCache=void 0;const lru_cache_1=require(`lru-cache`),node_path_1=require(`node:path`),node_url_1=require(`node:url`),fs_1=require(`fs`),actualFS=__importStar(require(`node:fs`)),realpathSync=fs_1.realpathSync.native,promises_1=require(`node:fs/promises`),minipass_1=require(`minipass`),defaultFS={lstatSync:fs_1.lstatSync,readdir:fs_1.readdir,readdirSync:fs_1.readdirSync,readlinkSync:fs_1.readlinkSync,realpathSync,promises:{lstat:promises_1.lstat,readdir:promises_1.readdir,readlink:promises_1.readlink,realpath:promises_1.realpath}},fsFromOption=e=>!e||e===defaultFS||e===actualFS?defaultFS:{...defaultFS,...e,promises:{...defaultFS.promises,...e.promises||{}}},uncDriveRegexp=/^\\\\\?\\([a-z]:)\\?$/i,uncToDrive=e=>e.replace(/\//g,`\\`).replace(uncDriveRegexp,`$1\\`),eitherSep=/[\\\/]/,UNKNOWN=0,IFIFO=1,IFCHR=2,IFDIR=4,IFBLK=6,IFREG=8,IFLNK=10,IFSOCK=12,IFMT=15,IFMT_UNKNOWN=-16,READDIR_CALLED=16,LSTAT_CALLED=32,ENOTDIR=64,ENOENT=128,ENOREADLINK=256,ENOREALPATH=512,ENOCHILD=704,TYPEMASK=1023,entToType=e=>e.isFile()?8:e.isDirectory()?4:e.isSymbolicLink()?10:e.isCharacterDevice()?2:e.isBlockDevice()?6:e.isSocket()?12:e.isFIFO()?1:0,normalizeCache=new lru_cache_1.LRUCache({max:2**12}),normalize=e=>{let t=normalizeCache.get(e);if(t)return t;let n=e.normalize(`NFKD`);return normalizeCache.set(e,n),n},normalizeNocaseCache=new lru_cache_1.LRUCache({max:2**12}),normalizeNocase=e=>{let t=normalizeNocaseCache.get(e);if(t)return t;let n=normalize(e.toLowerCase());return normalizeNocaseCache.set(e,n),n};class ResolveCache extends lru_cache_1.LRUCache{constructor(){super({max:256})}}exports.ResolveCache=ResolveCache;class ChildrenCache extends lru_cache_1.LRUCache{constructor(e=16*1024){super({maxSize:e,sizeCalculation:e=>e.length+1})}}exports.ChildrenCache=ChildrenCache;const setAsCwd=Symbol(`PathScurry setAsCwd`);class PathBase{name;root;roots;parent;nocase;isCWD=!1;#fs;#dev;get dev(){return this.#dev}#mode;get mode(){return this.#mode}#nlink;get nlink(){return this.#nlink}#uid;get uid(){return this.#uid}#gid;get gid(){return this.#gid}#rdev;get rdev(){return this.#rdev}#blksize;get blksize(){return this.#blksize}#ino;get ino(){return this.#ino}#size;get size(){return this.#size}#blocks;get blocks(){return this.#blocks}#atimeMs;get atimeMs(){return this.#atimeMs}#mtimeMs;get mtimeMs(){return this.#mtimeMs}#ctimeMs;get ctimeMs(){return this.#ctimeMs}#birthtimeMs;get birthtimeMs(){return this.#birthtimeMs}#atime;get atime(){return this.#atime}#mtime;get mtime(){return this.#mtime}#ctime;get ctime(){return this.#ctime}#birthtime;get birthtime(){return this.#birthtime}#matchName;#depth;#fullpath;#fullpathPosix;#relative;#relativePosix;#type;#children;#linkTarget;#realpath;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(e,t=0,n,r,i,a,o){this.name=e,this.#matchName=i?normalizeNocase(e):normalize(e),this.#type=t&1023,this.nocase=i,this.roots=r,this.root=n||this,this.#children=a,this.#fullpath=o.fullpath,this.#relative=o.relative,this.#relativePosix=o.relativePosix,this.parent=o.parent,this.parent?this.#fs=this.parent.#fs:this.#fs=fsFromOption(o.fs)}depth(){return this.#depth===void 0?this.parent?this.#depth=this.parent.depth()+1:this.#depth=0:this.#depth}childrenCache(){return this.#children}resolve(e){if(!e)return this;let t=this.getRootString(e),n=e.substring(t.length).split(this.splitSep);return t?this.getRoot(t).#resolveParts(n):this.#resolveParts(n)}#resolveParts(e){let t=this;for(let n of e)t=t.child(n);return t}children(){let e=this.#children.get(this);if(e)return e;let t=Object.assign([],{provisional:0});return this.#children.set(this,t),this.#type&=-17,t}child(e,t){if(e===``||e===`.`)return this;if(e===`..`)return this.parent||this;let n=this.children(),r=this.nocase?normalizeNocase(e):normalize(e);for(let e of n)if(e.#matchName===r)return e;let i=this.parent?this.sep:``,a=this.#fullpath?this.#fullpath+i+e:void 0,o=this.newChild(e,0,{...t,parent:this,fullpath:a});return this.canReaddir()||(o.#type|=128),n.push(o),o}relative(){if(this.isCWD)return``;if(this.#relative!==void 0)return this.#relative;let e=this.name,t=this.parent;if(!t)return this.#relative=this.name;let n=t.relative();return n+(!n||!t.parent?``:this.sep)+e}relativePosix(){if(this.sep===`/`)return this.relative();if(this.isCWD)return``;if(this.#relativePosix!==void 0)return this.#relativePosix;let e=this.name,t=this.parent;if(!t)return this.#relativePosix=this.fullpathPosix();let n=t.relativePosix();return n+(!n||!t.parent?``:`/`)+e}fullpath(){if(this.#fullpath!==void 0)return this.#fullpath;let e=this.name,t=this.parent;return t?this.#fullpath=t.fullpath()+(t.parent?this.sep:``)+e:this.#fullpath=this.name}fullpathPosix(){if(this.#fullpathPosix!==void 0)return this.#fullpathPosix;if(this.sep===`/`)return this.#fullpathPosix=this.fullpath();if(!this.parent){let e=this.fullpath().replace(/\\/g,`/`);return/^[a-z]:\//i.test(e)?this.#fullpathPosix=`//?/${e}`:this.#fullpathPosix=e}let e=this.parent,t=e.fullpathPosix();return this.#fullpathPosix=t+(!t||!e.parent?``:`/`)+this.name}isUnknown(){return(this.#type&15)==0}isType(e){return this[`is${e}`]()}getType(){return this.isUnknown()?`Unknown`:this.isDirectory()?`Directory`:this.isFile()?`File`:this.isSymbolicLink()?`SymbolicLink`:this.isFIFO()?`FIFO`:this.isCharacterDevice()?`CharacterDevice`:this.isBlockDevice()?`BlockDevice`:this.isSocket()?`Socket`:`Unknown`}isFile(){return(this.#type&15)==8}isDirectory(){return(this.#type&15)==4}isCharacterDevice(){return(this.#type&15)==2}isBlockDevice(){return(this.#type&15)==6}isFIFO(){return(this.#type&15)==1}isSocket(){return(this.#type&15)==12}isSymbolicLink(){return(this.#type&10)==10}lstatCached(){return this.#type&32?this:void 0}readlinkCached(){return this.#linkTarget}realpathCached(){return this.#realpath}readdirCached(){let e=this.children();return e.slice(0,e.provisional)}canReadlink(){if(this.#linkTarget)return!0;if(!this.parent)return!1;let e=this.#type&15;return!(e!==0&&e!==10||this.#type&256||this.#type&128)}calledReaddir(){return!!(this.#type&16)}isENOENT(){return!!(this.#type&128)}isNamed(e){return this.nocase?this.#matchName===normalizeNocase(e):this.#matchName===normalize(e)}async readlink(){let e=this.#linkTarget;if(e)return e;if(this.canReadlink()&&this.parent)try{let e=await this.#fs.promises.readlink(this.fullpath()),t=(await this.parent.realpath())?.resolve(e);if(t)return this.#linkTarget=t}catch(e){this.#readlinkFail(e.code);return}}readlinkSync(){let e=this.#linkTarget;if(e)return e;if(this.canReadlink()&&this.parent)try{let e=this.#fs.readlinkSync(this.fullpath()),t=this.parent.realpathSync()?.resolve(e);if(t)return this.#linkTarget=t}catch(e){this.#readlinkFail(e.code);return}}#readdirSuccess(e){this.#type|=16;for(let t=e.provisional;t<e.length;t++){let n=e[t];n&&n.#markENOENT()}}#markENOENT(){this.#type&128||(this.#type=(this.#type|128)&-16,this.#markChildrenENOENT())}#markChildrenENOENT(){let e=this.children();e.provisional=0;for(let t of e)t.#markENOENT()}#markENOREALPATH(){this.#type|=512,this.#markENOTDIR()}#markENOTDIR(){if(this.#type&64)return;let e=this.#type;(e&15)==4&&(e&=-16),this.#type=e|64,this.#markChildrenENOENT()}#readdirFail(e=``){e===`ENOTDIR`||e===`EPERM`?this.#markENOTDIR():e===`ENOENT`?this.#markENOENT():this.children().provisional=0}#lstatFail(e=``){e===`ENOTDIR`?this.parent.#markENOTDIR():e===`ENOENT`&&this.#markENOENT()}#readlinkFail(e=``){let t=this.#type;t|=256,e===`ENOENT`&&(t|=128),(e===`EINVAL`||e===`UNKNOWN`)&&(t&=-16),this.#type=t,e===`ENOTDIR`&&this.parent&&this.parent.#markENOTDIR()}#readdirAddChild(e,t){return this.#readdirMaybePromoteChild(e,t)||this.#readdirAddNewChild(e,t)}#readdirAddNewChild(e,t){let n=entToType(e),r=this.newChild(e.name,n,{parent:this}),i=r.#type&15;return i!==4&&i!==10&&i!==0&&(r.#type|=64),t.unshift(r),t.provisional++,r}#readdirMaybePromoteChild(e,t){for(let n=t.provisional;n<t.length;n++){let r=t[n];if((this.nocase?normalizeNocase(e.name):normalize(e.name))===r.#matchName)return this.#readdirPromoteChild(e,r,n,t)}}#readdirPromoteChild(e,t,n,r){let i=t.name;return t.#type=t.#type&-16|entToType(e),i!==e.name&&(t.name=e.name),n!==r.provisional&&(n===r.length-1?r.pop():r.splice(n,1),r.unshift(t)),r.provisional++,t}async lstat(){if(!(this.#type&128))try{return this.#applyStat(await this.#fs.promises.lstat(this.fullpath())),this}catch(e){this.#lstatFail(e.code)}}lstatSync(){if(!(this.#type&128))try{return this.#applyStat(this.#fs.lstatSync(this.fullpath())),this}catch(e){this.#lstatFail(e.code)}}#applyStat(e){let{atime:t,atimeMs:n,birthtime:r,birthtimeMs:i,blksize:a,blocks:o,ctime:s,ctimeMs:c,dev:l,gid:u,ino:d,mode:f,mtime:p,mtimeMs:m,nlink:h,rdev:g,size:_,uid:v}=e;this.#atime=t,this.#atimeMs=n,this.#birthtime=r,this.#birthtimeMs=i,this.#blksize=a,this.#blocks=o,this.#ctime=s,this.#ctimeMs=c,this.#dev=l,this.#gid=u,this.#ino=d,this.#mode=f,this.#mtime=p,this.#mtimeMs=m,this.#nlink=h,this.#rdev=g,this.#size=_,this.#uid=v;let y=entToType(e);this.#type=this.#type&-16|y|32,y!==0&&y!==4&&y!==10&&(this.#type|=64)}#onReaddirCB=[];#readdirCBInFlight=!1;#callOnReaddirCB(e){this.#readdirCBInFlight=!1;let t=this.#onReaddirCB.slice();this.#onReaddirCB.length=0,t.forEach(t=>t(null,e))}readdirCB(e,t=!1){if(!this.canReaddir()){t?e(null,[]):queueMicrotask(()=>e(null,[]));return}let n=this.children();if(this.calledReaddir()){let r=n.slice(0,n.provisional);t?e(null,r):queueMicrotask(()=>e(null,r));return}if(this.#onReaddirCB.push(e),this.#readdirCBInFlight)return;this.#readdirCBInFlight=!0;let r=this.fullpath();this.#fs.readdir(r,{withFileTypes:!0},(e,t)=>{if(e)this.#readdirFail(e.code),n.provisional=0;else{for(let e of t)this.#readdirAddChild(e,n);this.#readdirSuccess(n)}this.#callOnReaddirCB(n.slice(0,n.provisional))})}#asyncReaddirInFlight;async readdir(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();if(this.#asyncReaddirInFlight)await this.#asyncReaddirInFlight;else{let n=()=>{};this.#asyncReaddirInFlight=new Promise(e=>n=e);try{for(let n of await this.#fs.promises.readdir(t,{withFileTypes:!0}))this.#readdirAddChild(n,e);this.#readdirSuccess(e)}catch(t){this.#readdirFail(t.code),e.provisional=0}this.#asyncReaddirInFlight=void 0,n()}return e.slice(0,e.provisional)}readdirSync(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();try{for(let n of this.#fs.readdirSync(t,{withFileTypes:!0}))this.#readdirAddChild(n,e);this.#readdirSuccess(e)}catch(t){this.#readdirFail(t.code),e.provisional=0}return e.slice(0,e.provisional)}canReaddir(){if(this.#type&704)return!1;let e=15&this.#type;return e===0||e===4||e===10}shouldWalk(e,t){return(this.#type&4)==4&&!(this.#type&704)&&!e.has(this)&&(!t||t(this))}async realpath(){if(this.#realpath)return this.#realpath;if(!(896&this.#type))try{let e=await this.#fs.promises.realpath(this.fullpath());return this.#realpath=this.resolve(e)}catch{this.#markENOREALPATH()}}realpathSync(){if(this.#realpath)return this.#realpath;if(!(896&this.#type))try{let e=this.#fs.realpathSync(this.fullpath());return this.#realpath=this.resolve(e)}catch{this.#markENOREALPATH()}}[setAsCwd](e){if(e===this)return;e.isCWD=!1,this.isCWD=!0;let t=new Set([]),n=[],r=this;for(;r&&r.parent;)t.add(r),r.#relative=n.join(this.sep),r.#relativePosix=n.join(`/`),r=r.parent,n.push(`..`);for(r=e;r&&r.parent&&!t.has(r);)r.#relative=void 0,r.#relativePosix=void 0,r=r.parent}}exports.PathBase=PathBase;class PathWin32 extends PathBase{sep=`\\`;splitSep=eitherSep;constructor(e,t=0,n,r,i,a,o){super(e,t,n,r,i,a,o)}newChild(e,t=0,n={}){return new PathWin32(e,t,this.root,this.roots,this.nocase,this.childrenCache(),n)}getRootString(e){return node_path_1.win32.parse(e).root}getRoot(e){if(e=uncToDrive(e.toUpperCase()),e===this.root.name)return this.root;for(let[t,n]of Object.entries(this.roots))if(this.sameRoot(e,t))return this.roots[e]=n;return this.roots[e]=new PathScurryWin32(e,this).root}sameRoot(e,t=this.root.name){return e=e.toUpperCase().replace(/\//g,`\\`).replace(uncDriveRegexp,`$1\\`),e===t}}exports.PathWin32=PathWin32;class PathPosix extends PathBase{splitSep=`/`;sep=`/`;constructor(e,t=0,n,r,i,a,o){super(e,t,n,r,i,a,o)}getRootString(e){return e.startsWith(`/`)?`/`:``}getRoot(e){return this.root}newChild(e,t=0,n={}){return new PathPosix(e,t,this.root,this.roots,this.nocase,this.childrenCache(),n)}}exports.PathPosix=PathPosix;class PathScurryBase{root;rootPath;roots;cwd;#resolveCache;#resolvePosixCache;#children;nocase;#fs;constructor(e=process.cwd(),t,n,{nocase:r,childrenCacheSize:i=16*1024,fs:o=defaultFS}={}){this.#fs=fsFromOption(o),(e instanceof URL||e.startsWith(`file://`))&&(e=(0,node_url_1.fileURLToPath)(e));let s=t.resolve(e);this.roots=Object.create(null),this.rootPath=this.parseRootPath(s),this.#resolveCache=new ResolveCache,this.#resolvePosixCache=new ResolveCache,this.#children=new ChildrenCache(i);let c=s.substring(this.rootPath.length).split(n);if(c.length===1&&!c[0]&&c.pop(),r===void 0)throw TypeError(`must provide nocase setting to PathScurryBase ctor`);this.nocase=r,this.root=this.newRoot(this.#fs),this.roots[this.rootPath]=this.root;let l=this.root,u=c.length-1,p=t.sep,m=this.rootPath,h=!1;for(let e of c){let t=u--;l=l.child(e,{relative:Array(t).fill(`..`).join(p),relativePosix:Array(t).fill(`..`).join(`/`),fullpath:m+=(h?``:p)+e}),h=!0}this.cwd=l}depth(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),e.depth()}childrenCache(){return this.#children}resolve(...e){let t=``;for(let n=e.length-1;n>=0;n--){let r=e[n];if(!(!r||r===`.`)&&(t=t?`${r}/${t}`:r,this.isAbsolute(r)))break}let n=this.#resolveCache.get(t);if(n!==void 0)return n;let r=this.cwd.resolve(t).fullpath();return this.#resolveCache.set(t,r),r}resolvePosix(...e){let t=``;for(let n=e.length-1;n>=0;n--){let r=e[n];if(!(!r||r===`.`)&&(t=t?`${r}/${t}`:r,this.isAbsolute(r)))break}let n=this.#resolvePosixCache.get(t);if(n!==void 0)return n;let r=this.cwd.resolve(t).fullpathPosix();return this.#resolvePosixCache.set(t,r),r}relative(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),e.relative()}relativePosix(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),e.relativePosix()}basename(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),e.name}dirname(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),(e.parent||e).fullpath()}async readdir(e=this.cwd,t={withFileTypes:!0}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n}=t;if(e.canReaddir()){let t=await e.readdir();return n?t:t.map(e=>e.name)}else return[]}readdirSync(e=this.cwd,t={withFileTypes:!0}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n=!0}=t;return e.canReaddir()?n?e.readdirSync():e.readdirSync().map(e=>e.name):[]}async lstat(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),e.lstat()}lstatSync(e=this.cwd){return typeof e==`string`&&(e=this.cwd.resolve(e)),e.lstatSync()}async readlink(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e.withFileTypes,e=this.cwd);let n=await e.readlink();return t?n:n?.fullpath()}readlinkSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e.withFileTypes,e=this.cwd);let n=e.readlinkSync();return t?n:n?.fullpath()}async realpath(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e.withFileTypes,e=this.cwd);let n=await e.realpath();return t?n:n?.fullpath()}realpathSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e.withFileTypes,e=this.cwd);let n=e.realpathSync();return t?n:n?.fullpath()}async walk(e=this.cwd,t={}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n=!0,follow:r=!1,filter:i,walkFilter:a}=t,o=[];(!i||i(e))&&o.push(n?e:e.fullpath());let s=new Set,c=(e,t)=>{s.add(e),e.readdirCB((e,l)=>{if(e)return t(e);let u=l.length;if(!u)return t();let d=()=>{--u===0&&t()};for(let e of l)(!i||i(e))&&o.push(n?e:e.fullpath()),r&&e.isSymbolicLink()?e.realpath().then(e=>e?.isUnknown()?e.lstat():e).then(e=>e?.shouldWalk(s,a)?c(e,d):d()):e.shouldWalk(s,a)?c(e,d):d()},!0)},l=e;return new Promise((e,t)=>{c(l,n=>{if(n)return t(n);e(o)})})}walkSync(e=this.cwd,t={}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n=!0,follow:r=!1,filter:i,walkFilter:a}=t,o=[];(!i||i(e))&&o.push(n?e:e.fullpath());let s=new Set([e]);for(let e of s){let t=e.readdirSync();for(let e of t){(!i||i(e))&&o.push(n?e:e.fullpath());let t=e;if(e.isSymbolicLink()){if(!(r&&(t=e.realpathSync())))continue;t.isUnknown()&&t.lstatSync()}t.shouldWalk(s,a)&&s.add(t)}}return o}[Symbol.asyncIterator](){return this.iterate()}iterate(e=this.cwd,t={}){return typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd),this.stream(e,t)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(e=this.cwd,t={}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n=!0,follow:r=!1,filter:i,walkFilter:a}=t;(!i||i(e))&&(yield n?e:e.fullpath());let o=new Set([e]);for(let e of o){let t=e.readdirSync();for(let e of t){(!i||i(e))&&(yield n?e:e.fullpath());let t=e;if(e.isSymbolicLink()){if(!(r&&(t=e.realpathSync())))continue;t.isUnknown()&&t.lstatSync()}t.shouldWalk(o,a)&&o.add(t)}}}stream(e=this.cwd,t={}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n=!0,follow:r=!1,filter:i,walkFilter:a}=t,o=new minipass_1.Minipass({objectMode:!0});(!i||i(e))&&o.write(n?e:e.fullpath());let s=new Set,c=[e],l=0,d=()=>{let e=!1;for(;!e;){let t=c.shift();if(!t){l===0&&o.end();return}l++,s.add(t);let u=(t,p,m=!1)=>{if(t)return o.emit(`error`,t);if(r&&!m){let e=[];for(let t of p)t.isSymbolicLink()&&e.push(t.realpath().then(e=>e?.isUnknown()?e.lstat():e));if(e.length){Promise.all(e).then(()=>u(null,p,!0));return}}for(let t of p)t&&(!i||i(t))&&(o.write(n?t:t.fullpath())||(e=!0));l--;for(let e of p){let t=e.realpathCached()||e;t.shouldWalk(s,a)&&c.push(t)}e&&!o.flowing?o.once(`drain`,d):f||d()},f=!0;t.readdirCB(u,!0),f=!1}};return d(),o}streamSync(e=this.cwd,t={}){typeof e==`string`?e=this.cwd.resolve(e):e instanceof PathBase||(t=e,e=this.cwd);let{withFileTypes:n=!0,follow:r=!1,filter:i,walkFilter:a}=t,o=new minipass_1.Minipass({objectMode:!0}),s=new Set;(!i||i(e))&&o.write(n?e:e.fullpath());let c=[e],l=0,d=()=>{let e=!1;for(;!e;){let t=c.shift();if(!t){l===0&&o.end();return}l++,s.add(t);let u=t.readdirSync();for(let t of u)(!i||i(t))&&(o.write(n?t:t.fullpath())||(e=!0));l--;for(let e of u){let t=e;if(e.isSymbolicLink()){if(!(r&&(t=e.realpathSync())))continue;t.isUnknown()&&t.lstatSync()}t.shouldWalk(s,a)&&c.push(t)}}e&&!o.flowing&&o.once(`drain`,d)};return d(),o}chdir(e=this.cwd){let t=this.cwd;this.cwd=typeof e==`string`?this.cwd.resolve(e):e,this.cwd[setAsCwd](t)}}exports.PathScurryBase=PathScurryBase;class PathScurryWin32 extends PathScurryBase{sep=`\\`;constructor(e=process.cwd(),t={}){let{nocase:n=!0}=t;super(e,node_path_1.win32,`\\`,{...t,nocase:n}),this.nocase=n;for(let e=this.cwd;e;e=e.parent)e.nocase=this.nocase}parseRootPath(e){return node_path_1.win32.parse(e).root.toUpperCase()}newRoot(e){return new PathWin32(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith(`/`)||e.startsWith(`\\`)||/^[a-z]:(\/|\\)/i.test(e)}}exports.PathScurryWin32=PathScurryWin32;class PathScurryPosix extends PathScurryBase{sep=`/`;constructor(e=process.cwd(),t={}){let{nocase:n=!1}=t;super(e,node_path_1.posix,`/`,{...t,nocase:n}),this.nocase=n}parseRootPath(e){return`/`}newRoot(e){return new PathPosix(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith(`/`)}}exports.PathScurryPosix=PathScurryPosix;class PathScurryDarwin extends PathScurryPosix{constructor(e=process.cwd(),t={}){let{nocase:n=!0}=t;super(e,{...t,nocase:n})}}exports.PathScurryDarwin=PathScurryDarwin,exports.Path=process.platform===`win32`?PathWin32:PathPosix,exports.PathScurry=process.platform===`win32`?PathScurryWin32:process.platform===`darwin`?PathScurryDarwin:PathScurryPosix;