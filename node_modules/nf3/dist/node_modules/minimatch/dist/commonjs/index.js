"use strict";Object.defineProperty(exports,`__esModule`,{value:!0}),exports.unescape=exports.escape=exports.AST=exports.Minimatch=exports.match=exports.makeRe=exports.braceExpand=exports.defaults=exports.filter=exports.GLOBSTAR=exports.sep=exports.minimatch=void 0;const brace_expansion_1=require(`@isaacs/brace-expansion`),assert_valid_pattern_js_1=require(`./assert-valid-pattern.js`),ast_js_1=require(`./ast.js`),escape_js_1=require(`./escape.js`),unescape_js_1=require(`./unescape.js`),minimatch=(e,n,r={})=>((0,assert_valid_pattern_js_1.assertValidPattern)(n),!r.nocomment&&n.charAt(0)===`#`?!1:new Minimatch(n,r).match(e));exports.minimatch=minimatch;const starDotExtRE=/^\*+([^+@!?\*\[\(]*)$/,starDotExtTest=e=>t=>!t.startsWith(`.`)&&t.endsWith(e),starDotExtTestDot=e=>t=>t.endsWith(e),starDotExtTestNocase=e=>(e=e.toLowerCase(),t=>!t.startsWith(`.`)&&t.toLowerCase().endsWith(e)),starDotExtTestNocaseDot=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),starDotStarRE=/^\*+\.\*+$/,starDotStarTest=e=>!e.startsWith(`.`)&&e.includes(`.`),starDotStarTestDot=e=>e!==`.`&&e!==`..`&&e.includes(`.`),dotStarRE=/^\.\*+$/,dotStarTest=e=>e!==`.`&&e!==`..`&&e.startsWith(`.`),starRE=/^\*+$/,starTest=e=>e.length!==0&&!e.startsWith(`.`),starTestDot=e=>e.length!==0&&e!==`.`&&e!==`..`,qmarksRE=/^\?+([^+@!?\*\[\(]*)?$/,qmarksTestNocase=([e,t=``])=>{let n=qmarksTestNoExt([e]);return t?(t=t.toLowerCase(),e=>n(e)&&e.toLowerCase().endsWith(t)):n},qmarksTestNocaseDot=([e,t=``])=>{let n=qmarksTestNoExtDot([e]);return t?(t=t.toLowerCase(),e=>n(e)&&e.toLowerCase().endsWith(t)):n},qmarksTestDot=([e,t=``])=>{let n=qmarksTestNoExtDot([e]);return t?e=>n(e)&&e.endsWith(t):n},qmarksTest=([e,t=``])=>{let n=qmarksTestNoExt([e]);return t?e=>n(e)&&e.endsWith(t):n},qmarksTestNoExt=([e])=>{let t=e.length;return e=>e.length===t&&!e.startsWith(`.`)},qmarksTestNoExtDot=([e])=>{let t=e.length;return e=>e.length===t&&e!==`.`&&e!==`..`},defaultPlatform=typeof process==`object`&&process?typeof process.env==`object`&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:`posix`,path={win32:{sep:`\\`},posix:{sep:`/`}};exports.sep=defaultPlatform===`win32`?path.win32.sep:path.posix.sep,exports.minimatch.sep=exports.sep,exports.GLOBSTAR=Symbol(`globstar **`),exports.minimatch.GLOBSTAR=exports.GLOBSTAR;const qmark=`[^/]`,star=`[^/]*?`,twoStarDot=`(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?`,twoStarNoDot=`(?:(?!(?:\\/|^)\\.).)*?`,filter=(e,t={})=>n=>(0,exports.minimatch)(n,e,t);exports.filter=filter,exports.minimatch.filter=exports.filter;const ext=(e,t={})=>Object.assign({},e,t),defaults=e=>{if(!e||typeof e!=`object`||!Object.keys(e).length)return exports.minimatch;let t=exports.minimatch;return Object.assign((n,r,i={})=>t(n,r,ext(e,i)),{Minimatch:class extends t.Minimatch{constructor(t,n={}){super(t,ext(e,n))}static defaults(n){return t.defaults(ext(e,n)).Minimatch}},AST:class extends t.AST{constructor(t,n,r={}){super(t,n,ext(e,r))}static fromGlob(n,r={}){return t.AST.fromGlob(n,ext(e,r))}},unescape:(n,r={})=>t.unescape(n,ext(e,r)),escape:(n,r={})=>t.escape(n,ext(e,r)),filter:(n,r={})=>t.filter(n,ext(e,r)),defaults:n=>t.defaults(ext(e,n)),makeRe:(n,r={})=>t.makeRe(n,ext(e,r)),braceExpand:(n,r={})=>t.braceExpand(n,ext(e,r)),match:(n,r,i={})=>t.match(n,r,ext(e,i)),sep:t.sep,GLOBSTAR:exports.GLOBSTAR})};exports.defaults=defaults,exports.minimatch.defaults=exports.defaults;const braceExpand=(n,r={})=>((0,assert_valid_pattern_js_1.assertValidPattern)(n),r.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:(0,brace_expansion_1.expand)(n));exports.braceExpand=braceExpand,exports.minimatch.braceExpand=exports.braceExpand;const makeRe=(e,t={})=>new Minimatch(e,t).makeRe();exports.makeRe=makeRe,exports.minimatch.makeRe=exports.makeRe;const match=(e,t,n={})=>{let r=new Minimatch(t,n);return e=e.filter(e=>r.match(e)),r.options.nonull&&!e.length&&e.push(t),e};exports.match=match,exports.minimatch.match=exports.match;const globMagic=/[?*]|[+@!]\(.*?\)|\[|\]/,regExpEscape=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,`\\$&`);class Minimatch{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,n={}){(0,assert_valid_pattern_js_1.assertValidPattern)(e),n||={},this.options=n,this.pattern=e,this.platform=n.platform||defaultPlatform,this.isWindows=this.platform===`win32`,this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,`/`)),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot===void 0?!!(this.isWindows&&this.nocase):n.windowsNoMagicRoot,this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let t of e)if(typeof t!=`string`)return!0;return!1}debug(...e){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)===`#`){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,this.globSet);let n=this.globSet.map(e=>this.slashSplit(e));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let r=this.globParts.map((e,t,n)=>{if(this.isWindows&&this.windowsNoMagicRoot){let t=e[0]===``&&e[1]===``&&(e[2]===`?`||!globMagic.test(e[2]))&&!globMagic.test(e[3]),n=/^[a-z]:/i.test(e[0]);if(t)return[...e.slice(0,4),...e.slice(4).map(e=>this.parse(e))];if(n)return[e[0],...e.slice(1).map(e=>this.parse(e))]}return e.map(e=>this.parse(e))});if(this.debug(this.pattern,r),this.set=r.filter(e=>e.indexOf(!1)===-1),this.isWindows)for(let e=0;e<this.set.length;e++){let t=this.set[e];t[0]===``&&t[1]===``&&this.globParts[e][2]===`?`&&typeof t[3]==`string`&&/^[a-z]:$/i.test(t[3])&&(t[2]=`?`)}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++)e[t][n]===`**`&&(e[t][n]=`*`);let{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(e=>{let t=-1;for(;(t=e.indexOf(`**`,t+1))!==-1;){let n=t;for(;e[n+1]===`**`;)n++;n!==t&&e.splice(t,n-t)}return e})}levelOneOptimize(e){return e.map(e=>(e=e.reduce((e,t)=>{let n=e[e.length-1];return t===`**`&&n===`**`?e:t===`..`&&n&&n!==`..`&&n!==`.`&&n!==`**`?(e.pop(),e):(e.push(t),e)},[]),e.length===0?[``]:e))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let n=1;n<e.length-1;n++){let r=e[n];n===1&&r===``&&e[0]===``||(r===`.`||r===``)&&(t=!0,e.splice(n,1),n--)}e[0]===`.`&&e.length===2&&(e[1]===`.`||e[1]===``)&&(t=!0,e.pop())}let n=0;for(;(n=e.indexOf(`..`,n+1))!==-1;){let r=e[n-1];r&&r!==`.`&&r!==`..`&&r!==`**`&&(t=!0,e.splice(n-1,2),n-=2)}}while(t);return e.length===0?[``]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let n of e){let r=-1;for(;(r=n.indexOf(`**`,r+1))!==-1;){let i=r;for(;n[i+1]===`**`;)i++;i>r&&n.splice(r+1,i-r);let a=n[r+1],o=n[r+2],s=n[r+3];if(a!==`..`||!o||o===`.`||o===`..`||!s||s===`.`||s===`..`)continue;t=!0,n.splice(r,1);let c=n.slice(0);c[r]=`**`,e.push(c),r--}if(!this.preserveMultipleSlashes){for(let e=1;e<n.length-1;e++){let r=n[e];e===1&&r===``&&n[0]===``||(r===`.`||r===``)&&(t=!0,n.splice(e,1),e--)}n[0]===`.`&&n.length===2&&(n[1]===`.`||n[1]===``)&&(t=!0,n.pop())}let i=0;for(;(i=n.indexOf(`..`,i+1))!==-1;){let e=n[i-1];if(e&&e!==`.`&&e!==`..`&&e!==`**`){t=!0;let e=i===1&&n[i+1]===`**`?[`.`]:[];n.splice(i-1,2,...e),n.length===0&&n.push(``),i-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let n=t+1;n<e.length;n++){let r=this.partsMatch(e[t],e[n],!this.preserveMultipleSlashes);if(r){e[t]=[],e[n]=r;break}}return e.filter(e=>e.length)}partsMatch(e,t,n=!1){let r=0,i=0,a=[],o=``;for(;r<e.length&&i<t.length;)if(e[r]===t[i])a.push(o===`b`?t[i]:e[r]),r++,i++;else if(n&&e[r]===`**`&&t[i]===e[r+1])a.push(e[r]),r++;else if(n&&t[i]===`**`&&e[r]===t[i+1])a.push(t[i]),i++;else if(e[r]===`*`&&t[i]&&(this.options.dot||!t[i].startsWith(`.`))&&t[i]!==`**`){if(o===`b`)return!1;o=`a`,a.push(e[r]),r++,i++}else if(t[i]===`*`&&e[r]&&(this.options.dot||!e[r].startsWith(`.`))&&e[r]!==`**`){if(o===`a`)return!1;o=`b`,a.push(t[i]),r++,i++}else return!1;return e.length===t.length&&a}parseNegate(){if(this.nonegate)return;let e=this.pattern,t=!1,n=0;for(let r=0;r<e.length&&e.charAt(r)===`!`;r++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n=!1){let r=this.options;if(this.isWindows){let n=typeof e[0]==`string`&&/^[a-z]:$/i.test(e[0]),r=!n&&e[0]===``&&e[1]===``&&e[2]===`?`&&/^[a-z]:$/i.test(e[3]),i=typeof t[0]==`string`&&/^[a-z]:$/i.test(t[0]),a=!i&&t[0]===``&&t[1]===``&&t[2]===`?`&&typeof t[3]==`string`&&/^[a-z]:$/i.test(t[3]),o=r?3:n?0:void 0,s=a?3:i?0:void 0;if(typeof o==`number`&&typeof s==`number`){let[n,r]=[e[o],t[s]];n.toLowerCase()===r.toLowerCase()&&(t[s]=n,s>o?t=t.slice(s):o>s&&(e=e.slice(o)))}}let{optimizationLevel:i=1}=this.options;i>=2&&(e=this.levelTwoFileOptimize(e)),this.debug(`matchOne`,this,{file:e,pattern:t}),this.debug(`matchOne`,e.length,t.length);for(var a=0,o=0,s=e.length,c=t.length;a<s&&o<c;a++,o++){this.debug(`matchOne loop`);var l=t[o],u=e[a];if(this.debug(t,l,u),l===!1)return!1;if(l===exports.GLOBSTAR){this.debug(`GLOBSTAR`,[t,l,u]);var d=a,f=o+1;if(f===c){for(this.debug(`** at the end`);a<s;a++)if(e[a]===`.`||e[a]===`..`||!r.dot&&e[a].charAt(0)===`.`)return!1;return!0}for(;d<s;){var p=e[d];if(this.debug(`
globstar while`,e,d,t,f,p),this.matchOne(e.slice(d),t.slice(f),n))return this.debug(`globstar found match!`,d,s,p),!0;if(p===`.`||p===`..`||!r.dot&&p.charAt(0)===`.`){this.debug(`dot detected!`,e,d,t,f);break}this.debug(`globstar swallow a segment, and continue`),d++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,d,t,f),d===s))}let i;if(typeof l==`string`?(i=u===l,this.debug(`string match`,l,u,i)):(i=l.test(u),this.debug(`pattern match`,l,u,i)),!i)return!1}if(a===s&&o===c)return!0;if(a===s)return n;if(o===c)return a===s-1&&e[a]===``;throw Error(`wtf?`)}braceExpand(){return(0,exports.braceExpand)(this.pattern,this.options)}parse(e){(0,assert_valid_pattern_js_1.assertValidPattern)(e);let r=this.options;if(e===`**`)return exports.GLOBSTAR;if(e===``)return``;let i,a=null;(i=e.match(starRE))?a=r.dot?starTestDot:starTest:(i=e.match(starDotExtRE))?a=(r.nocase?r.dot?starDotExtTestNocaseDot:starDotExtTestNocase:r.dot?starDotExtTestDot:starDotExtTest)(i[1]):(i=e.match(qmarksRE))?a=(r.nocase?r.dot?qmarksTestNocaseDot:qmarksTestNocase:r.dot?qmarksTestDot:qmarksTest)(i):(i=e.match(starDotStarRE))?a=r.dot?starDotStarTestDot:starDotStarTest:(i=e.match(dotStarRE))&&(a=dotStarTest);let m=ast_js_1.AST.fromGlob(e,this.options).toMMPattern();return a&&typeof m==`object`&&Reflect.defineProperty(m,`test`,{value:a}),m}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?`[^/]*?`:t.dot?`(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?`:`(?:(?!(?:\\/|^)\\.).)*?`,r=new Set(t.nocase?[`i`]:[]),i=e.map(e=>{let t=e.map(e=>{if(e instanceof RegExp)for(let t of e.flags.split(``))r.add(t);return typeof e==`string`?regExpEscape(e):e===exports.GLOBSTAR?exports.GLOBSTAR:e._src});t.forEach((e,r)=>{let i=t[r+1],a=t[r-1];e!==exports.GLOBSTAR||a===exports.GLOBSTAR||(a===void 0?i!==void 0&&i!==exports.GLOBSTAR?t[r+1]=`(?:\\/|`+n+`\\/)?`+i:t[r]=n:i===void 0?t[r-1]=a+`(?:\\/|\\/`+n+`)?`:i!==exports.GLOBSTAR&&(t[r-1]=a+`(?:\\/|\\/`+n+`\\/)`+i,t[r+1]=exports.GLOBSTAR))});let i=t.filter(e=>e!==exports.GLOBSTAR);if(this.partial&&i.length>=1){let e=[];for(let t=1;t<=i.length;t++)e.push(i.slice(0,t).join(`/`));return`(?:`+e.join(`|`)+`)`}return i.join(`/`)}).join(`|`),[a,o]=e.length>1?[`(?:`,`)`]:[``,``];i=`^`+a+i+o+`$`,this.partial&&(i=`^(?:\\/|`+a+i.slice(1,-1)+o+`)$`),this.negate&&(i=`^(?!`+i+`).+$`);try{this.regexp=new RegExp(i,[...r].join(``))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split(`/`):this.isWindows&&/^\/\/[^\/]+/.test(e)?[``,...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug(`match`,e,this.pattern),this.comment)return!1;if(this.empty)return e===``;if(e===`/`&&t)return!0;let n=this.options;this.isWindows&&(e=e.split(`\\`).join(`/`));let r=this.slashSplit(e);this.debug(this.pattern,`split`,r);let i=this.set;this.debug(this.pattern,`set`,i);let a=r[r.length-1];if(!a)for(let e=r.length-2;!a&&e>=0;e--)a=r[e];for(let e=0;e<i.length;e++){let o=i[e],s=r;if(n.matchBase&&o.length===1&&(s=[a]),this.matchOne(s,o,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return exports.minimatch.defaults(e).Minimatch}}exports.Minimatch=Minimatch;var ast_js_2=require(`./ast.js`);Object.defineProperty(exports,`AST`,{enumerable:!0,get:function(){return ast_js_2.AST}});var escape_js_2=require(`./escape.js`);Object.defineProperty(exports,`escape`,{enumerable:!0,get:function(){return escape_js_2.escape}});var unescape_js_2=require(`./unescape.js`);Object.defineProperty(exports,`unescape`,{enumerable:!0,get:function(){return unescape_js_2.unescape}}),exports.minimatch.AST=ast_js_1.AST,exports.minimatch.Minimatch=Minimatch,exports.minimatch.escape=escape_js_1.escape,exports.minimatch.unescape=unescape_js_1.unescape;