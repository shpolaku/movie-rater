"use strict";module.exports=exports=http_mock;const fs=require(`fs`),path=require(`path`),nock=require(`nock`),os=require(`os`),log=require(`../util/log.js`);log.heading=`node-pre-gyp`;function http_mock(){log.warn(`mocking http requests to s3`);let r=`${os.tmpdir()}/mock`;nock(RegExp(`([a-z0-9]+[.])*s3[.]us-east-1[.]amazonaws[.]com`)).persist().get(()=>!0).reply(e=>{let t=`npg-mock-bucket`,n=e.indexOf(t)===-1?`${r}/${t}`:r,i=path.join(n,e.replace(RegExp(`%2B`,`g`),`+`));try{fs.accessSync(i,fs.constants.R_OK)}catch{return[404,`not found
`]}return[200,fs.createReadStream(i)]})}