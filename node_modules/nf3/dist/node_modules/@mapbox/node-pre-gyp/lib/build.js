"use strict";module.exports=exports=build,exports.usage=`Attempts to compile the module by dispatching to node-gyp or nw-gyp`;const napi=require(`./util/napi.js`),compile=require(`./util/compile.js`),handle_gyp_opts=require(`./util/handle_gyp_opts.js`),configure=require(`./configure.js`);function do_build(r,i,a){handle_gyp_opts(r,i,(n,r)=>{let i=[`build`].concat(r.gyp,r.pre);r.unparsed.length>0&&(i=i.concat([`--`]).concat(r.unparsed)),!n&&r.opts.napi_build_version&&napi.swap_build_dir_in(r.opts.napi_build_version),compile.run_gyp(i,r.opts,t=>(r.opts.napi_build_version&&napi.swap_build_dir_out(r.opts.napi_build_version),a(t)))})}function build(e,n,a){if(n.length&&n.indexOf(`rebuild`)>-1)n.shift(),compile.run_gyp([`clean`],{},t=>{if(t)return a(t);configure(e,n,t=>t?a(t):do_build(e,n,a))});else return do_build(e,n,a)}