"use strict";module.exports=exports=unpublish,exports.usage=`Unpublishes pre-built binary (requires aws-sdk)`;const log=require(`./util/log.js`),versioning=require(`./util/versioning.js`),napi=require(`./util/napi.js`),s3_setup=require(`./util/s3_setup.js`),url=require(`url`);function unpublish(n,r,i){let a=n.package_json,o=napi.get_napi_build_version_from_command_args(r),s=versioning.evaluate(a,n.opts,o),c=s3_setup.detect(s),l=s3_setup.get_s3(c),u=url.resolve(c.prefix,s.package_name),d={Bucket:c.bucket,Key:u};l.headObject(d,(e,t)=>{if(e&&e.code===`NotFound`)return console.log(`[`+a.name+`] Not found: `+s.hosted_tarball),i();if(e)return i(e);log.info(`unpublish`,JSON.stringify(t)),l.deleteObject(d,(e,t)=>e?i(e):(log.info(JSON.stringify(t)),console.log(`[`+a.name+`] Success: removed `+s.hosted_tarball),i()))})}