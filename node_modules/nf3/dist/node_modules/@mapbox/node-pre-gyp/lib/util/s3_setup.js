"use strict";module.exports=exports;const url=require(`url`);module.exports.detect=function(t){let n={},r=t.hosted_path,i=url.parse(r);if(t.bucket&&t.region){n.endpoint=t.host,n.bucket=t.bucket,n.region=t.region,n.s3ForcePathStyle=t.s3ForcePathStyle;let e=n.s3ForcePathStyle?`/${n.bucket}/`:`/`;n.prefix=!i.pathname||i.pathname===e?``:i.pathname.replace(e,``)}else{let e=i.hostname.split(`.s3`);if(e.length===1)throw Error(`Could not parse s3 bucket name from virtual host url.`);n.bucket=e[0];let t=e[1].slice(1).split(`.`)[0];t===`amazonaws`?n.region=`us-east-1`:n.region=t,n.prefix=!i.pathname||i.pathname===`/`?``:i.pathname.replace(`/`,``)}return n},module.exports.get_s3=function(e){if(process.env.node_pre_gyp_mock_s3)return require(`../mock/s3`)();let t=require(`aws-sdk`);t.config.update(e);let n=new t.S3;return{listObjects(e,t){return n.listObjects(e,t)},headObject(e,t){return n.headObject(e,t)},deleteObject(e,t){return n.deleteObject(e,t)},putObject(e,t){return n.putObject(e,t)},getObject(e,t){return n.getObject(e,t)}}};