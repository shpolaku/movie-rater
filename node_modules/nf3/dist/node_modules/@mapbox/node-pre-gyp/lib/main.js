"use strict";process.title=`node-pre-gyp`;const node_pre_gyp=require(`../`),log=require(`./util/log.js`),prog=new node_pre_gyp.Run({argv:process.argv});let completed=!1;prog.todo.length===0&&(~process.argv.indexOf(`-v`)||~process.argv.indexOf(`--version`)?(console.log(`v%s`,prog.version),process.exit(0)):(~process.argv.indexOf(`-h`)||~process.argv.indexOf(`--help`))&&(console.log(`%s`,prog.usage()),process.exit(0)),console.log(`%s`,prog.usage()),process.exit(1)),prog.opts&&Object.hasOwnProperty.call(prog,`color`)&&!prog.opts.color&&log.disableColor(),log.info(`it worked if it ends with`,`ok`),log.verbose(`cli`,process.argv),log.info(`using ${process.title}@${prog.version}`),log.info(`using node@${process.versions.node} | ${process.platform} | ${process.arch} `);const dir=prog.opts.directory;if(dir){let e=require(`fs`);try{e.statSync(dir).isDirectory()?(log.info(`chdir`,dir),process.chdir(dir)):log.warn(`chdir`,dir+` is not a directory`)}catch(e){e.code===`ENOENT`?log.warn(`chdir`,dir+` is not a directory`):log.warn(`chdir`,`error during chdir() "${e.message}"`)}}function run(){let e=prog.todo.shift();if(!e){completed=!0,log.info(`ok`);return}prog.setBinaryHostProperty(e.name)&&[`install`,`publish`,`unpublish`,`info`].indexOf(e.name)>=0&&log.info(`using binary.host: `+prog.package_json.binary.host),prog.commands[e.name](e.args,function(t){if(t)return log.error(e.name+` error`),log.error(`stack`,t.stack),errorMessage(),log.error(`not ok`),console.log(t.message),process.exit(1);let n=[].slice.call(arguments,1);n.length&&console.log.apply(console,n),process.nextTick(run)})}process.on(`exit`,e=>{!completed&&!e&&(log.error(`Completion callback never invoked!`),errorMessage(),process.exit(6))}),process.on(`uncaughtException`,e=>{log.error(`UNCAUGHT EXCEPTION`),log.error(`stack`,e.stack),errorMessage(),process.exit(7)});function errorMessage(){let e=require(`os`);log.error(`System`,e.type()+` `+e.release()),log.error(`command`,process.argv.map(JSON.stringify).join(` `)),log.error(`cwd`,process.cwd()),log.error(`node -v`,process.version),log.error(process.title+` -v`,`v`+prog.package.version)}run();