"use strict";module.exports=exports=configure,exports.usage=`Attempts to configure node-gyp or nw-gyp build`;const napi=require(`./util/napi.js`),compile=require(`./util/compile.js`),handle_gyp_opts=require(`./util/handle_gyp_opts.js`);function configure(r,i,a){handle_gyp_opts(r,i,(n,i)=>{let o=i.gyp.concat(i.pre);if([`dist-url`,`python`,`nodedir`,`msvs_version`].forEach(e=>{let t=r.opts[e]||r.opts[e.replace(`-`,`_`)];t&&o.push(`--`+e+`=`+t)}),r.opts.ensure===!1){let e=o.concat([`install`,`--ensure=false`]);compile.run_gyp(e,i.opts,e=>{if(e)return a(e);i.unparsed.length>0&&(o=o.concat([`--`]).concat(i.unparsed)),compile.run_gyp([`configure`].concat(o),i.opts,e=>a(e))})}else i.unparsed.length>0&&(o=o.concat([`--`]).concat(i.unparsed)),compile.run_gyp([`configure`].concat(o),i.opts,t=>(!t&&i.opts.napi_build_version&&napi.swap_build_dir_out(i.opts.napi_build_version),a(t)))})}