"use strict";Object.defineProperty(exports,`__esModule`,{value:!0}),exports.importAttributesOrAssertions=exports.importAttributes=exports.importAssertions=void 0;var _acorn=_interopRequireWildcard(require(`acorn`));function _getRequireWildcardCache(e){if(typeof WeakMap!=`function`)return null;var n=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:n})(e)}function _interopRequireWildcard(e,n){if(!n&&e&&e.__esModule)return e;if(e===null||typeof e!=`object`&&typeof e!=`function`)return{default:e};var r=_getRequireWildcardCache(n);if(r&&r.has(e))return r.get(e);var i={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!==`default`&&{}.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}const leftCurlyBrace=123,space=32,withKeyword=`with`,assertKeyword=`assert`,FUNC_STATEMENT=1,FUNC_HANGING_STATEMENT=2,FUNC_NULLABLE_ID=4,importAttributes=exports.importAttributes=plugin({keyword:`with`}),importAssertions=exports.importAssertions=plugin({keyword:`assert`}),importAttributesOrAssertions=exports.importAttributesOrAssertions=plugin({keyword:`with-assert`});function plugin(e){return function(t){return pluginImpl(e,t)}}function pluginImpl(t,n){let{tokTypes:r,TokenType:i}=n.acorn||_acorn,{keyword:s}=t,c=s.includes(withKeyword),l=s.includes(assertKeyword),u=c&&l;return class extends n{constructor(...e){super(...e),this.withToken=c&&new i(withKeyword),this.assertToken=l&&new i(assertKeyword)}_codeAt(e){return this.input.charCodeAt(e)}_eat(e){this.type!==e&&this.unexpected(),this.next()}_matchKeywordToken(){return u&&(this.type===this.withToken||this.type===this.assertToken)||c&&this.type===this.withToken||l&&this.type===this.assertToken}_getProperty(){return u?this.type===this.withToken?`attributes`:`assertions`:c?`attributes`:`assertions`}readToken(e){let t=0,n,r;if(u){if(this.input.slice(this.pos,this.pos+4)===withKeyword)n=withKeyword,r=this.withToken;else if(this.input.slice(this.pos,this.pos+6)===assertKeyword)n=assertKeyword,r=this.assertToken;else return super.readToken(e);t+=n.length}else for(n=c?withKeyword:assertKeyword,r=c?this.withToken:this.assertToken;t<n.length;t++)if(this._codeAt(this.pos+t)!==n.charCodeAt(t))return super.readToken(e);for(;this._codeAt(this.pos+t)!==123;t++)if(this._codeAt(this.pos+t)!==32)return super.readToken(e);return this.type.label===`{`?super.readToken(e):(this.pos+=n.length,this.finishToken(r))}parseDynamicImport(e){return this.next(),e.source=this.parseMaybeAssign(),this.eat(r.comma)&&(e.arguments=[this.parseExpression()]),this._eat(r.parenR),this.finishNode(e,`ImportExpression`)}parseExport(e,t){if(this.next(),this.eat(r.star)){if(this.options.ecmaVersion>=11&&(this.eatContextual(`as`)?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual(`from`),this.type!==r.string&&this.unexpected(),e.source=this.parseExprAtom(),this._matchKeywordToken()){let t=this._getProperty();this.next();let n=this.parseImportAttributes();n&&(e[t]=n)}return this.semicolon(),this.finishNode(e,`ExportAllDeclaration`)}if(this.eat(r._default)){this.checkExport(t,`default`,this.lastTokStart);var n;if(this.type===r._function||(n=this.isAsyncFunction())){var i=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(i,5,!1,n)}else if(this.type===r._class){var a=this.startNode();e.declaration=this.parseClass(a,`nullableID`)}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,`ExportDefaultDeclaration`)}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),e.declaration.type===`VariableDeclaration`?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual(`from`)){if(this.type!==r.string&&this.unexpected(),e.source=this.parseExprAtom(),this._matchKeywordToken()){let t=this._getProperty();this.next();let n=this.parseImportAttributes();n&&(e[t]=n)}}else{for(var o=0,s=e.specifiers;o<s.length;o+=1){var c=s[o];this.checkUnreserved(c.local),this.checkLocalExport(c.local)}e.source=null}this.semicolon()}return this.finishNode(e,`ExportNamedDeclaration`)}parseImport(e){if(this.next(),this.type===r.string?(e.specifiers=[],e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual(`from`),e.source=this.type===r.string?this.parseExprAtom():this.unexpected()),this._matchKeywordToken()){let t=this._getProperty();this.next();let n=this.parseImportAttributes();n&&(e[t]=n)}return this.semicolon(),this.finishNode(e,`ImportDeclaration`)}parseImportAttributes(){this._eat(r.braceL);let e=this.parsewithEntries();return this._eat(r.braceR),e}parsewithEntries(){let e=[],t=new Set;do{if(this.type===r.braceR)break;let n=this.startNode(),i;i=this.type===r.string?this.parseLiteral(this.value):this.parseIdent(!0),this.next(),n.key=i,t.has(n.key.name)&&this.raise(this.pos,`Duplicated key in attributes`),t.add(n.key.name),this.type!==r.string&&this.raise(this.pos,`Only string is supported as an attribute value`),n.value=this.parseLiteral(this.value),e.push(this.finishNode(n,`ImportAttribute`))}while(this.eat(r.comma));return e}}}